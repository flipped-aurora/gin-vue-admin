<template>
  <div class="gva-theme-font">
    <div class="mb-10">
      <div class="gva-theme-section-header">
        <div class="gva-theme-divider"></div>
        <span class="gva-theme-section-title">ç³»ç»Ÿä¿¡æ¯</span>
        <div class="gva-theme-divider"></div>
      </div>

      <div class="gva-theme-section-content">
        <div class="gva-theme-card-bg">
          <div class="grid grid-cols-2 gap-4 text-sm">
            <div class="flex justify-between items-center py-3 border-b border-gray-200 dark:border-gray-600">
              <span class="gva-theme-text-sub font-medium">ç‰ˆæœ¬</span>
              <span class="font-mono gva-theme-text-main font-semibold">v2.7.4</span>
            </div>
            <div class="flex justify-between items-center py-3 border-b border-gray-200 dark:border-gray-600">
              <span class="gva-theme-text-sub font-medium">å‰ç«¯æ¡†æ¶</span>
              <span class="font-mono gva-theme-text-main font-semibold">Vue 3</span>
            </div>
            <div class="flex justify-between items-center py-3 border-b border-gray-200 dark:border-gray-600">
              <span class="gva-theme-text-sub font-medium">UI ç»„ä»¶åº“</span>
              <span class="font-mono gva-theme-text-main font-semibold">Element Plus</span>
            </div>
            <div class="flex justify-between items-center py-3 border-b border-gray-200 dark:border-gray-600">
              <span class="gva-theme-text-sub font-medium">æ„å»ºå·¥å…·</span>
              <span class="font-mono gva-theme-text-main font-semibold">Vite</span>
            </div>
            <div class="flex justify-between items-center py-3">
              <span class="gva-theme-text-sub font-medium">æµè§ˆå™¨</span>
              <span class="font-mono gva-theme-text-main font-semibold">{{ browserInfo }}</span>
            </div>
            <div class="flex justify-between items-center py-3">
              <span class="gva-theme-text-sub font-medium">å±å¹•åˆ†è¾¨ç‡</span>
              <span class="font-mono gva-theme-text-main font-semibold">{{ screenResolution }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="mb-10">
      <div class="gva-theme-section-header">
        <div class="gva-theme-divider"></div>
        <span class="gva-theme-section-title">é…ç½®ç®¡ç†</span>
        <div class="gva-theme-divider"></div>
      </div>

      <div class="gva-theme-section-content">
        <div class="gva-theme-card-bg">
          <div class="space-y-5">
            <div
              class="gva-theme-card-white flex items-center justify-between">
              <div class="flex items-center gap-4">
                <div
                  class="w-12 h-12 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl flex items-center justify-center text-red-600 dark:text-red-400 text-xl">
                  ğŸ”„
                </div>
                <div>
                  <h4 class="text-sm font-semibold gva-theme-text-main">é‡ç½®é…ç½®</h4>
                  <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">å°†æ‰€æœ‰è®¾ç½®æ¢å¤ä¸ºé»˜è®¤å€¼</p>
                </div>
              </div>
              <el-button type="danger" size="small"
                class="rounded-lg font-medium transition-all duration-150 ease-in-out hover:-translate-y-0.5"
                @click="handleResetConfig">
                é‡ç½®é…ç½®
              </el-button>
            </div>

            <div
              class="gva-theme-card-white flex items-center justify-between">
              <div class="flex items-center gap-4">
                <div
                  class="w-12 h-12 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-xl flex items-center justify-center text-blue-600 dark:text-blue-400 text-xl">
                  ğŸ“¤
                </div>
                <div>
                  <h4 class="text-sm font-semibold gva-theme-text-main">å¯¼å‡ºé…ç½®</h4>
                  <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">å¯¼å‡ºå½“å‰é…ç½®ä¸º JSON æ–‡ä»¶</p>
                </div>
              </div>
              <el-button type="primary" size="small"
                class="rounded-lg font-medium transition-all duration-150 ease-in-out hover:-translate-y-0.5"
                :style="{ backgroundColor: config.primaryColor, borderColor: config.primaryColor }"
                @click="handleExportConfig">
                å¯¼å‡ºé…ç½®
              </el-button>
            </div>

            <div
              class="gva-theme-card-white flex items-center justify-between">
              <div class="flex items-center gap-4">
                <div
                  class="w-12 h-12 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-xl flex items-center justify-center text-green-600 dark:text-green-400 text-xl">
                  ğŸ“¥
                </div>
                <div>
                  <h4 class="text-sm font-semibold gva-theme-text-main">å¯¼å…¥é…ç½®</h4>
                  <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">ä» JSON æ–‡ä»¶å¯¼å…¥é…ç½®</p>
                </div>
              </div>
              <el-upload ref="uploadRef" :auto-upload="false" :show-file-list="false" accept=".json"
                @change="handleImportConfig">
                <el-button type="success" size="small"
                  class="rounded-lg font-medium transition-all duration-150 ease-in-out hover:-translate-y-0.5">
                  å¯¼å…¥é…ç½®
                </el-button>
              </el-upload>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="mb-10">
      <div class="gva-theme-section-header">
        <div class="gva-theme-divider"></div>
        <span class="gva-theme-section-title">å…³äºé¡¹ç›®</span>
        <div class="gva-theme-divider"></div>
      </div>

      <div class="gva-theme-section-content">
        <div class="gva-theme-card-bg">
          <div class="flex items-start gap-5">
            <div
              class="w-16 h-16 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl flex items-center justify-center flex-shrink-0 shadow-sm">
              <Logo />
            </div>
            <div class="flex-1">
              <h4 class="text-xl font-semibold gva-theme-text-main mb-3">Gin-Vue-Admin</h4>
              <p class="text-sm gva-theme-text-sub mb-5 leading-relaxed">
                åŸºäº Vue3 + Gin çš„å…¨æ ˆå¼€å‘åŸºç¡€å¹³å°ï¼Œæä¾›å®Œæ•´çš„åå°ç®¡ç†è§£å†³æ–¹æ¡ˆ
              </p>
              <div class="flex items-center gap-3 text-sm">
                <a href="https://github.com/flipped-aurora/gin-vue-admin" target="_blank"
                  class="font-medium transition-colors duration-150 hover:underline"
                  :style="{ color: config.primaryColor }">
                  GitHub ä»“åº“
                </a>
                <span class="text-gray-400 dark:text-gray-500">Â·</span>
                <a href="https://www.gin-vue-admin.com/" target="_blank"
                  class="font-medium transition-colors duration-150 hover:underline"
                  :style="{ color: config.primaryColor }">
                  å®˜æ–¹æ–‡æ¡£
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue'
import { ElMessage, ElMessageBox } from 'element-plus'
import { storeToRefs } from 'pinia'
import { useAppStore } from '@/pinia'
import Logo from '@/components/logo/index.vue'

defineOptions({
  name: 'GeneralSettings'
})

const appStore = useAppStore()
const { config } = storeToRefs(appStore)
const uploadRef = ref()

const browserInfo = ref('')
const screenResolution = ref('')

onMounted(() => {
  const userAgent = navigator.userAgent
  if (userAgent.includes('Chrome')) {
    browserInfo.value = 'Chrome'
  } else if (userAgent.includes('Firefox')) {
    browserInfo.value = 'Firefox'
  } else if (userAgent.includes('Safari')) {
    browserInfo.value = 'Safari'
  } else if (userAgent.includes('Edge')) {
    browserInfo.value = 'Edge'
  } else {
    browserInfo.value = 'Unknown'
  }

  screenResolution.value = `${screen.width}Ã—${screen.height}`
})

const handleResetConfig = async () => {
  try {
    await ElMessageBox.confirm(
      'ç¡®å®šè¦é‡ç½®æ‰€æœ‰é…ç½®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚',
      'é‡ç½®é…ç½®',
      {
        confirmButtonText: 'ç¡®å®š',
        cancelButtonText: 'å–æ¶ˆ',
        type: 'warning'
      }
    )

    appStore.resetConfig()
    ElMessage.success('é…ç½®å·²é‡ç½®')
  } catch {
    // User cancelled
  }
}

const handleExportConfig = () => {
  const configData = JSON.stringify(config.value, null, 2)
  const blob = new Blob([configData], { type: 'application/json' })
  const url = URL.createObjectURL(blob)

  const link = document.createElement('a')
  link.href = url
  link.download = `gin-vue-admin-config-${new Date().toISOString().split('T')[0]}.json`
  document.body.appendChild(link)
  link.click()
  document.body.removeChild(link)
  URL.revokeObjectURL(url)

  ElMessage.success('é…ç½®å·²å¯¼å‡º')
}

const handleImportConfig = (file) => {
  const reader = new FileReader()
  reader.onload = (e) => {
    try {
      const importedConfig = JSON.parse(e.target.result)

      Object.keys(importedConfig).forEach(key => {
        if (key in config.value) {
          config.value[key] = importedConfig[key]
        }
      })

      ElMessage.success('é…ç½®å·²å¯¼å…¥')
    } catch (error) {
      ElMessage.error('é…ç½®æ–‡ä»¶æ ¼å¼é”™è¯¯')
    }
  }
  reader.readAsText(file.raw)
}
</script>


