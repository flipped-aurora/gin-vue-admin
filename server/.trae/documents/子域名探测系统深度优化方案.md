# 子域名探测系统深度优化方案

我们将对现有的域名监控插件进行升级，构建一个集探测、验证、分析、导出为一体的闭环子域名管理系统。

## 技术实现细节

### 1. 后端架构增强
- **数据模型升级**: 在 `DomainAsset` 模型中新增 `IP` (存储解析地址) 和 `DiscoverySource` (记录来源：CTLog/BruteForce) 字段。
- **并发探测引擎**: 
    - **DNS 验证**: 使用 `net.LookupHost` 对发现的子域名进行实时 A 记录解析，确认存活并获取 IP。
    - **爆破模式**: 集成内置高频子域名字典（如 www, api, mail, dev, test 等），采用协程池控制并发，对根域名进行主动枚举。
    - **CT Log 集成**: 优化现有 `crt.sh` 抓取逻辑，提取更全面的签发记录。
- **关联分析优化**: 增强递归关联算法，确保 `a.b.example.com` 能精准挂载到 `b.example.com` 节点下。
- **数据报表**: 利用 `excelize` 库生成包含域名层级、IP、证书状态、发现来源的结构化 Excel 报告。

### 2. 前端展示与交互
- **可视化树形图**: 
    - 列表展示新增 "解析 IP" 和 "来源" 列。
    - 状态灯实时反映域名解析与证书有效性。
- **功能控制**:
    - 探测对话框增加“深度扫描（爆破模式）”选项。
    - 树形管理页面增加“导出详细报告”功能。

## 实施步骤

### 第一阶段：数据模型与 API
1. 修改 `model/domain_asset.go` 增加字段。
2. 在 `api/cert_advanced.go` 增加导出 API。

### 第二阶段：核心探测逻辑
1. 在 `service/subdomain_discovery.go` 实现并发 DNS 解析与字典爆破。
2. 实现 Excel 报告生成逻辑。

### 第三阶段：前端集成
1. 更新 `domainTree.vue` 界面组件。
2. 对接新 API，实现导出与深度探测。

## 验证方法
- 通过 `docker-compose` 重新构建并运行系统。
- 针对测试域名执行“深度扫描”，验证是否能发现字典中的隐藏子域名并正确解析 IP。
- 导出报告并检查数据完整性。

您是否同意按照此方案进行开发？